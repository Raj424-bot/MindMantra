<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MindMantra Admin Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2e8b57;
    }
    .question-box {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .question-meta {
      font-size: 12px;
      color: gray;
      margin-bottom: 10px;
    }
    textarea {
      width: 100%;
      height: 80px;
      margin-top: 10px;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    select {
      margin-top: 10px;
      padding: 5px;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #2e8b57;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>MindMantra Admin Dashboard</h1>
  <div id="questionList">Loading questions...</div>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdHFYYdU_X_7LNuoFGWxDMD2nzLkE439I",
      authDomain: "mindmantra-2556a.firebaseapp.com",
      projectId: "mindmantra-2556a",
      storageBucket: "mindmantra-2556a.appspot.com",
      messagingSenderId: "899345272918",
      appId: "1:899345272918:web:321428c86ee15ccda66bf7",
      measurementId: "G-J06YXLQL1F"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadQuestions() {
      const querySnapshot = await getDocs(collection(db, "questions"));
      const questionList = document.getElementById("questionList");
      questionList.innerHTML = '';

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const dateTime = new Date(data.timestamp?.seconds * 1000).toLocaleString();

        const questionBox = document.createElement('div');
        questionBox.className = 'question-box';

        questionBox.innerHTML = `
          <div class="question-meta">ðŸ•’ Asked on: ${dateTime}</div>
          <p><strong>Question:</strong> ${data.question}</p>

          <textarea id="textReply-${docSnap.id}" placeholder="Type your text reply..."></textarea>
          
          <label>ðŸŽ¤ Audio Reply:</label>
          <input type="file" id="audioReply-${docSnap.id}" accept="audio/*">

          <label>ðŸ“¹ Video Reply:</label>
          <input type="file" id="videoReply-${docSnap.id}" accept="video/*">

          <label>ðŸ”’ Privacy:</label>
          <select id="privacy-${docSnap.id}">
            <option value="individual">Individual</option>
            <option value="public">Public</option>
          </select>

          <button onclick="submitReply('${docSnap.id}')">Submit Reply</button>
        `;

        questionList.appendChild(questionBox);
      });
    }

    window.submitReply = async function(docId) {
      const text = document.getElementById(textReply-${docId}).value;
      const privacy = document.getElementById(privacy-${docId}).value;
      const audioFile = document.getElementById(audioReply-${docId}).files[0];
      const videoFile = document.getElementById(videoReply-${docId}).files[0];

      // Only store metadata in Firestore for now
      const updateData = {
        textReply: text || null,
        privacy: privacy,
        replyTime: new Date().toISOString(),
        hasAudio: audioFile ? true : false,
        hasVideo: videoFile ? true : false
      };

      await updateDoc(doc(db, "questions", docId), updateData);
      alert("Reply saved!");
    }

    loadQuestions();
  </script>

</body>
</html>
